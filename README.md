# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

## Архитектура приложения
Приложение организовано в соответствии с паттерном MVP (Model-View-Presenter):

- Model: Управляет данными, их хранением и изменением. Модели инкапсулируют бизнес-логику и взаимодействуют с сервером.

- View: Отвечает за визуальное представление компонентов на странице. View не содержит логики, только отрисовку и обработку пользовательских событий.

- Presenter: Обеспечивает взаимодействие между View и Model. Presenter обрабатывает события от View, обновляет Model и управляет состоянием View.

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Описание интерфейса

Интерфейс можно условно разделить на 3 процесса:

1. Просмотр каталога товаров (MainScreen)
2. Просмотр карточки товара (CardPreview)
3. Оформление заказа (Modal)


---


## Данные и типы данных, используемые в приложении


В этом разделе описаны основные интерфейсы, используемые в приложении для работы с карточками товаров, оплатой заказа и контактной информацией.

---

### 1. Интерфейс карточки товара

Определяет структуру данных, которая представляет отдельную карточку товара.

```
export interface IProductCard {
  id: string;           // Уникальный идентификатор товара
  description: string;  // Описание товара
  image: string;        // Ссылка на изображение товара
  title: string;        // Название товара
  category: string;     // Категория, к которой относится товар
  price: number;        // Стоимость товара
};
```

---

### 2. Интерфейс для работы с коллекцией карточек

Определяет работу с коллекцией карточек. 

```
export interface IProductCatalog {
  items: IProductCard[];                           // Массив карточек товаров
};
```

---

### 3. Интерфейс данных оплаты заказа

Определяет набор полей, необходимых для оформления оплаты заказа. Содержит информацию о способе оплаты и адресе доставки.


```
export interface IPaymentDetails {
  method: string;   // Метод оплаты
  address: string;  // Адрес доставки товара
};
```


---

### 4. Интерфейс контактной информации

Содержит контактные данные пользователя, такие как email и телефон.

```
export interface IContactInfo {
  email: string;  // Email пользователя
  phone: string;  // Телефон пользователя
};
```

---

### 5. Интерфейс итоговых данных заказа

Определяет структуру данных, передаваемых на сервер при оформлении заказа. Включает контактную информацию, способы оплаты, идентификаторы товаров и общую стоимость заказа.

```
export interface IOrderSummary {
  email: string;    // Email покупателя
  phone: string;    // Телефон покупателя
  address: string;  // Адрес доставки
  payment: string;  // Способ оплаты
  id: string[];     // Список идентификаторов товаров, включенных в заказ
  total: number;    // Общая сумма заказа
};
```

---

### 6. Интерфейс результата заказа

Отражает ответ, получаемый от сервера после оформления заказа. Содержит итоговую стоимость.

```
export interface IOrderResponse {
  id: string;     // Уникальный идентификатор заказа, сформированный сервером
  total: number;  // Итоговая стоимость заказа
};
```

---

### 7. Интерфейс полных данных для оформления заказа

Представляет полный набор данных, необходимых для заполнения заказа. Используется для первичной подготовки данных перед отправкой на сервер.

```
export interface IFullOrderData {
  email: string;    // Email покупателя
  phone: string;    // Телефон покупателя
  address: string;  // Адрес доставки
  payment: string;  // Метод оплаты
};
```



---

# Базовый код


## Абстрактный класс Component<T>

Базовый класс для всех компонентов приложения. Принимает дженерик T, который определяет тип данных, используемых компонентом.

### Свойства:
- container: HTMLElement — корневой элемент компонента.

- events: EventEmitter — экземпляр EventEmitter для управления событиями.

### Конструктор:
- constructor(protected container: HTMLElement, events: EventEmitter)

### Методы:
- setText(element: HTMLElement, value: string): void
Устанавливает текстовое содержимое для указанного элемента.

- setImage(element: HTMLImageElement, src: string, alt?: string): void
Устанавливает изображение и альтернативный текст для элемента.


---

## Класс Api

Класс Api инкапсулирует взаимодействие с сервером, предоставляя методы для отправки и получения данных.

### Свойства
- readonly baseUrl: string — базовый URL сервера.

- protected options: RequestInit — конфигурация для HTTP-запросов.

### Конструктор
- constructor(baseUrl: string, options: RequestInit = {})

### Методы
- handleResponse(response: Response)  
  Обрабатывает ответ, полученный от сервера.

- get(endpoint: string)  
  Выполняет GET-запрос по заданному URL-эндпоинту.

- post(endpoint: string, data: any)  
  Отправляет POST-запрос на сервер с переданными данными.

---

## Класс Modal

Компонент для работы с модальными окнами.


### Свойства
- closeModalButton: HTMLButtonElement — кнопка закрытия модального окна.

- content: HTMLElement — контейнер для содержимого модального окна.

### Методы
- open(): void
Открывает модальное окно.

- close(): void
Закрывает модальное окно.

- closeModalEscape(event: KeyboardEvent): void
Закрывает модальное окно при нажатии клавиши Escape.

- render(content: HTMLElement): void
Отрисовывает содержимое модального окна.

---

## Класс Form

Базовый класс для работы с формами. Отвечает за валидацию и отображение ошибок.

### Свойства
- submit: HTMLButtonElement — кнопка отправки формы.

- errors: HTMLElement — элемент для отображения сообщений об ошибках.

### Конструктор
- constructor(container: HTMLElement, events: EventEmitter)

### Методы
- set errors(value: string)
Устанавливает текст ошибки и отображает его в интерфейсе.

---


# Модели


## Класс ProductCardsData 

Модель для работы с данными карточки товара. Реализует интерфейс IProductCardsData.


#### Свойства
- items: IProductCard[] — массив карточек товаров.

- events: EventEmitter — экземпляр EventEmitter для генерации событий.

### Конструктор
- constructor(events: EventEmitter)

#### Методы
- set items(value: IProductCard[])
Устанавливает массив карточек товаров.

- get items(): IProductCard[]
Возвращает текущий массив карточек товаров.

- findCardById(cardId: string): IProductCard | undefined
Возвращает карточку товара по идентификатору.

---


## Класс BasketData

Класс BasketData управляет данными корзины. Реализует интерфейс IBasketData.

#### Свойства
- items: IProductCard[] — массив товаров в корзине.

- events: EventEmitter — экземпляр EventEmitter для генерации событий.

### Конструктор
- constructor(events: EventEmitter)

#### Методы
- addProduct(product: IProductCard): void
Добавляет товар в корзину.

- removeProduct(id: string): void
Удаляет товар из корзины по идентификатору.

- getItemCount(): number
Возвращает количество товаров в корзине.

- getTotal(): number
Возвращает общую стоимость товаров в корзине.

- hasProduct(id: string): boolean
Проверяет, есть ли товар с указанным идентификатором в корзине.

- clearBasket(): void
Очищает корзину.

---


## Класс OrderData

Класс OrderData представляет модель для хранения данных заказа, полученных от пользователя. Реализует интерфейс TFullOrderData.

#### Свойства
- order: IFullOrderData — объект, содержащий данные пользователя (email, телефон, адрес, способ оплаты).

- validationErrors: Record<string, string> — объект, содержащий ошибки валидации.

### Конструктор
- constructor(events: EventEmitter)

### Методы
- setOrder(data: IFullOrderData): void
Сохраняет введённые пользователем данные в объект заказа.

- updatePaymentMethod(method: string): void
Обновляет способ оплаты в данных заказа.

- validateOrder(): Record<string, string>
Проверяет заполненность полей и возвращает объект с ошибками валидации.

---



# Отображения

В данном разделе описана реализация визуальных компонентов приложения. Все классы отвечают за отрисовку, управление отображением элементов и генерацию событий, связанных с пользовательским интерфейсом.

---


## Класс ProductCard

Компонент для отображения карточки товара.


### Свойства
- id: string — уникальный идентификатор карточки.

- title: HTMLElement — элемент для отображения названия товара.

- category?: HTMLElement — элемент для отображения категории товара.

- image?: HTMLImageElement — элемент для отображения изображения товара.

- price: HTMLElement — элемент для отображения цены товара.

### Конструктор
- constructor(container: HTMLElement, events: EventEmitter)

### Методы
- set id(value: string)
Устанавливает идентификатор карточки.

- set title(value: string)
Устанавливает название товара.

- set category(value: string)
Устанавливает категорию товара.

- set image(value: string)
Устанавливает изображение товара.

- set price(value: number)
Устанавливает цену товара.

---


## Класс PaymentForm

Отвечает за визуализацию формы, в которой пользователь выбирает способ оплаты и вводит адрес доставки. Реализует интерфейс IPaymentData.

### Свойства
- paymentMethod: HTMLButtonElement[] — массив кнопок для выбора способа оплаты.

- paymentMethodCard: HTMLButtonElement — кнопка выбора оплаты картой.

- paymentMethodCash: HTMLButtonElement — кнопка выбора оплаты наличными.

### Конструктор
- constructor(container: HTMLElement, events: EventEmitter)

### Методы
- set valid(value: boolean)
Управляет состоянием кнопок (включено/выключено).

- set address(value: string)
Устанавливает значение поля для ввода адреса.


---


## Класс ContactForm

Отвечает за визуализацию формы, в которой пользователь вводит контактную информацию пользователя (email и телефон). Реализует интерфейс IContactData.

### Свойства
- emailInput: HTMLInputElement — поле для ввода email.

- phoneInput: HTMLInputElement — поле для ввода телефона.

### Конструктор
- constructor(container: HTMLElement, events: EventEmitter)

### Методы
- set valid(value: boolean)
Управляет состоянием кнопок (включено/выключено).

- set phone(value: string)
Устанавливает значение поля для ввода телефона.

- set email(value: string)
Устанавливает значение поля для ввода email.


---


## Класс OrderResponse

Компонент для отображения финального окна с подтверждением заказа.


### Свойства
- total: HTMLElement — элемент для отображения итоговой суммы заказа.

### Конструктор
- constructor(container: HTMLElement, events: EventEmitter)

### Методы
- set totalPrice(value: number)
Устанавливает и отображает итоговую сумму заказа.

---

# Взаимодействие компонентов

Логика взаимодействия между представлением (View) и данными (Model) реализована в файле index.ts, который выступает в роли презентера (Presenter). Взаимодействие строится на основе событий, которые генерируются с использованием механизма EventEmitter. Обработка этих событий настраивается в index.ts.


## Список событий

### В системе используются следующие события:

- events.onAll — Прослушивание всех событий в системе.

- basket:changed — Событие, возникающее при изменении состояния корзины.

- card:select — Выбор карточки товара для отображения в модальном окне.

- delete:card — Удаление карточки товара из корзины.

- basket:open — Открытие корзины.

- modal:open — Открытие модального окна.

- modal:close — Закрытие модального окна.

- order:changed — Изменение данных пользователя в заказе.

- payment:change — Изменение выбранного способа оплаты.

- order:open — Открытие модального окна для выбора оплаты и ввода адреса.

- order:submit — Открытие модального окна для ввода контактной информации.

- ^order\..*:change — Регулярное выражение для отслеживания изменений в окне выбора оплаты и адреса.

- ^contacts\..*:change — Регулярное выражение для отслеживания изменений в окне ввода email и телефона.

- contacts:submit — Отправка заказа и открытие финального окна с подтверждением.