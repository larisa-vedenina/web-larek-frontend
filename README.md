# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

## Архитектура приложения
Приложение организовано в соответствии с паттерном MVP (Model-View-Presenter):

- Model: Управляет данными, их хранением и изменением. Модели инкапсулируют бизнес-логику и взаимодействуют с сервером.

- View: Отвечает за визуальное представление компонентов на странице. View не содержит логики, только отрисовку и обработку пользовательских событий.

- Presenter: Обеспечивает взаимодействие между View и Model. Presenter обрабатывает события от View, обновляет Model и управляет состоянием View.

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Описание интерфейса

Интерфейс можно условно разделить на 3 процесса:

1. Просмотр каталога товаров (MainScreen)
2. Просмотр карточки товара (CardPreview)
3. Оформление заказа (Modal)


---


## Данные и типы данных, используемые в приложении


В этом разделе описаны основные интерфейсы, используемые в приложении для работы с карточками товаров, оплатой заказа и контактной информацией.

---

### 1. Интерфейс карточки товара

Определяет структуру данных, которая представляет отдельную карточку товара.

```
export interface IProductCard {
  id: string;           // Уникальный идентификатор товара
  description: string;  // Описание товара
  image: string;        // Ссылка на изображение товара
  title: string;        // Название товара
  category: string;     // Категория, к которой относится товар
  price: number | null;     // Стоимость товара
};
```

---

### 2. Интерфейс для работы с коллекцией карточек

Определяет работу с коллекцией карточек. 

```
export interface IProductCardsData {
  items: IProductCard[];                           // Массив карточек товаров
};
```

---

### 3. Интерфейс данных оплаты заказа

Определяет набор полей, необходимых для оформления оплаты заказа. Содержит информацию о способе оплаты и адресе доставки.


```
export interface IPaymentData {
  method: string;   // Метод оплаты
  address: string;  // Адрес доставки товара
};
```


---

### 4. Интерфейс контактной информации

Содержит контактные данные пользователя, такие как email и телефон.

```
export interface IContactData {
  email: string;  // Email пользователя
  phone: string;  // Телефон пользователя
};
```

---

### 5. Интерфейс итоговых данных заказа

Определяет структуру данных, передаваемых на сервер при оформлении заказа. Включает контактную информацию, способы оплаты, идентификаторы товаров и общую стоимость заказа.

```
export interface IOrderSummary {
  email: string;    // Email покупателя
  phone: string;    // Телефон покупателя
  address: string;  // Адрес доставки
  payment: string;  // Способ оплаты
  id: string[];     // Список идентификаторов товаров, включенных в заказ
  total: number;    // Общая сумма заказа
};
```

---

### 6. Интерфейс результата заказа

Отражает ответ, получаемый от сервера после оформления заказа. Содержит итоговую стоимость.

```
export interface IOrderResponse {
  id: string;     // Уникальный идентификатор заказа, сформированный сервером
  total: number;  // Итоговая стоимость заказа
};
```

---

### 7. Интерфейс полных данных для оформления заказа

Представляет полный набор данных, необходимых для заполнения заказа. Используется для первичной подготовки данных перед отправкой на сервер.

```
export interface IFullOrderData {
  email: string;    // Email покупателя
  phone: string;    // Телефон покупателя
  address: string;  // Адрес доставки
  payment: string;  // Метод оплаты
};
```



---

# Базовый код

## Класс EventEmitter 

Класс EventEmitter предназначен для управления событиями и их обработчиками в приложении. 

### Свойства
- _events: Map<EventName, Set<Subscriber>> – хранит события и их подписчиков.

EventName — тип, представляющий имя события.

Subscriber — тип, представляющий функцию-обработчик события.

### Конструктор
- constructor()
Создает новый экземпляр EventEmitter.

### Методы

- on<T extends object>(eventName: EventName, callback: (event: T) => void): void – pегистрирует обработчик для заданного события. 

- off(eventName: EventName, callback: Subscriber): void – удаляет обработчик с указанного события.

- emit<T extends object>(eventName: string, data?: T): void – генерирует событие и передаёт ему данные. 

- trigger<T extends object>(eventName: string, context?: Partial<T>): (event?: object) => void – создает и возвращает функцию-триггер, которая при вызове генерирует указанное событие.

---

## Абстрактный класс Component<T>

Базовый класс для всех компонентов приложения. Принимает дженерик T, который определяет тип данных, используемых компонентом.

### Свойства:
- container: HTMLElement — корневой элемент компонента.

- events: EventEmitter — экземпляр EventEmitter для управления событиями.

### Конструктор:
- constructor(protected container: HTMLElement, events: EventEmitter)

### Методы:
- setText(element: HTMLElement, value: string): void
Устанавливает текстовое содержимое для указанного элемента.

- setImage(element: HTMLImageElement, src: string, alt?: string): void
Устанавливает изображение и альтернативный текст для элемента.


---

## Класс Api

Класс Api инкапсулирует взаимодействие с сервером, предоставляя методы для отправки и получения данных.

### Свойства
- readonly baseUrl: string — базовый URL сервера.

- protected options: RequestInit — конфигурация для HTTP-запросов.

### Конструктор
- constructor(baseUrl: string, options: RequestInit = {})

### Методы
- handleResponse(response: Response)  
  Обрабатывает ответ, полученный от сервера.

- get(endpoint: string)  
  Выполняет GET-запрос по заданному URL-эндпоинту.

- post(endpoint: string, data: any)  
  Отправляет POST-запрос на сервер с переданными данными.


---


# Модели


## Класс ProductCardsData

Отвечает за управление данными карточек товаров. 

### Свойства
- `_items: IProductCard[]` — список карточек товаров.
- `events: IEvents` — объект для работы с событиями.

### Конструктор
- `constructor(events: IEvents)`  
  Инициализирует объект для работы с данными карточек товаров.

### Методы
- `set items(items: IProductCard[])`  
  Обновляет список карточек товаров.

- `get items(): IProductCard[]`  
  Возвращает список карточек товаров.

- `findCardById(cardId: string): IProductCard`  
  Находит карточку товара по её идентификатору. Если карточка не найдена, выбрасывает ошибку.

---


## Класс BasketData

Класс BasketData управляет данными корзины. Реализует интерфейс IBasketData.

#### Свойства
- items: IProductCard[] — массив товаров в корзине.

- events: EventEmitter — экземпляр EventEmitter для генерации событий.

### Конструктор
- constructor(events: EventEmitter)

#### Методы
- addProduct(product: IProductCard): void
Добавляет товар в корзину.

- removeProduct(id: string): void
Удаляет товар из корзины по идентификатору.

- getItemCount(): number
Возвращает количество товаров в корзине.

- getTotal(): number
Возвращает общую стоимость товаров в корзине.

- hasProduct(id: string): boolean
Проверяет, есть ли товар с указанным идентификатором в корзине.

- clearBasket(): void
Очищает корзину.

---


## Класс OrderData

Класс OrderData Отвечает за управление данными заказа, включая валидацию и обновление полей заказа. Реализует интерфейс `IOrderData`.

### Свойства
- `order: TFullOrderData` — объект, содержащий данные заказа (email, телефон, способ оплаты, адрес).
- `formErrors: TFormErrors` — объект, содержащий ошибки валидации полей заказа.

### Конструктор
- `constructor(protected events: IEvents)`  
  Инициализирует объект для работы с данными заказа и подключает систему событий.

### Методы
- `get orderData(): TFullOrderData`  
  Возвращает текущие данные заказа.

- `get errors(): Partial<Record<keyof TFullOrderData, string>>`  
  Возвращает текущие ошибки валидации.

- `setOrderField(field: keyof TFullOrderData, value: string): void`  
  Устанавливает значение для указанного поля заказа и запускает валидацию.

- `updatePaymentMethod(method: string): void`  
  Обновляет способ оплаты и запускает валидацию.

- `validateOrder(): boolean`  
  Проверяет корректность данных заказа. Возвращает `true`, если ошибок нет, иначе `false`.

- `clearOrder(): void`  
  Очищает данные заказа и уведомляет об изменении.

---



# Отображения

В данном разделе описана реализация визуальных компонентов приложения. Все классы отвечают за отрисовку, управление отображением элементов и генерацию событий, связанных с пользовательским интерфейсом.

---

## Класс Page

Отвечает за управление основными элементами страницы, такими как счетчик товаров в корзине, каталог товаров и блокировка страницы при открытии модальных окон.

### Свойства
- `_counter: HTMLElement` — элемент для отображения количества товаров в корзине.
- `_catalog: HTMLElement` — контейнер для отображения каталога товаров.
- `_wrapper: HTMLElement` — обертка страницы для блокировки прокрутки.
- `_basket: HTMLElement` — элемент корзины, на который можно кликнуть для открытия.

### Конструктор
- `constructor(container: HTMLElement, protected events: IEvents)`  
  Инициализирует страницу, находит необходимые элементы в DOM и настраивает обработчики событий.

### Методы
- `set counter(value: number)`  
  Устанавливает количество товаров в корзине.

- `set catalog(items: HTMLElement[])`  
  Обновляет содержимое каталога товаров.

- `set locked(value: boolean)`  
  Блокирует или разблокирует прокрутку страницы, добавляя или удаляя класс `page__wrapper_locked`.


---


## Класс Modal

Отвечает за управление модальным окном. Реализует функциональность открытия, закрытия и обновления содержимого модального окна.

### Свойства
- `_closeButton: HTMLButtonElement` — кнопка закрытия модального окна.
- `_content: HTMLElement` — контейнер для содержимого модального окна.

### Конструктор
- `constructor(container: HTMLElement, protected events: IEvents)`  
  Инициализирует модальное окно, находит необходимые элементы в DOM и настраивает обработчики событий для закрытия.

### Методы
- `set content(value: HTMLElement)`  
  Устанавливает содержимое модального окна.

- `open()`  
  Открывает модальное окно, добавляя класс `modal_active`, и уведомляет об открытии.

- `close()`  
  Закрывает модальное окно, удаляя класс `modal_active`, очищает содержимое и уведомляет о закрытии.

- `handleEscUp(evt: KeyboardEvent)`  
  Закрывает модальное окно при нажатии клавиши `Escape`.

- `render(data: IModalData): HTMLElement`  
  Обновляет содержимое модального окна и открывает его.

---

## Класс Form

Базовый класс для работы с формами. Отвечает за обработку изменений полей формы, отправку формы и отображение ошибок.

### Свойства
- `_submitButton: HTMLButtonElement` — кнопка отправки формы.
- `_errorContainer: HTMLElement` — контейнер для отображения ошибок.

### Конструктор
- `constructor(protected container: HTMLFormElement, protected events: IEvents)`  
  Инициализирует форму, находит необходимые элементы в DOM и настраивает обработчики событий.

### Методы
- `protected handleInputChange(field: keyof T, value: string)`  
  Обрабатывает изменение значения поля формы и уведомляет об этом.

- `set errors(value: string)`  
  Устанавливает текст ошибок в контейнер для ошибок.

- `render(state: Partial<T> & IFormState)`  
  Обновляет состояние формы, включая валидность и ошибки.


---

## Класс ProductCard

Отвечает за отображение карточки товара на странице. 

### Свойства
- `cardId: string` — уникальный идентификатор карточки.
- `_title: HTMLElement` — элемент для отображения названия товара.
- `_image: HTMLImageElement` — элемент для отображения изображения товара (опционально).
- `_category: HTMLElement` — элемент для отображения категории товара (опционально).
- `_price: HTMLElement` — элемент для отображения цены товара.
- `button: HTMLButtonElement` — кнопка, связанная с карточкой (опционально).
- `events: IEvents` — объект для работы с событиями.

### Конструктор
- `constructor(container: HTMLElement, events: IEvents, actions?: ICardActions)`  
  Инициализирует карточку товара, находит необходимые элементы в DOM и настраивает обработчики событий.

### Методы
- `set id(id: string)`  
  Устанавливает уникальный идентификатор карточки.

- `get id(): string`  
  Возвращает уникальный идентификатор карточки.

- `set title(value: string)`  
  Устанавливает название товара.

- `set price(value: number | null)`  
  Устанавливает цену товара. Если цена равна `null`, отображается текст "Бесценно".

- `set category(value: string)`  
  Устанавливает категорию товара и изменяет цвет фона в зависимости от категории.

- `set image(link: string)`  
  Устанавливает изображение товара.

---

## Класс ModalCardPreview

Расширяет класс `ProductCard` и отвечает за отображение карточки товара в модальном окне предварительного просмотра. 

### Свойства
- `_description: HTMLElement` — элемент для отображения описания товара.
- `buyButton: HTMLButtonElement` — кнопка "Купить".

### Конструктор
- `constructor(container: HTMLElement, events: IEvents, actions?: ICardActions)`  
  Инициализирует карточку товара в модальном окне, находит элементы описания и кнопки "Купить", настраивает обработчики событий.

### Методы
- `get buyButtonElement(): HTMLButtonElement`  
  Возвращает кнопку "Купить".

- `set description(description: string)`  
  Устанавливает описание товара.

- `setDisabled(button: HTMLButtonElement, isDisabled: boolean)`  
  Блокирует или разблокирует кнопку "Купить".

- `replaceButtonText(isInCart: boolean)`  
  Изменяет текст кнопки "Купить" в зависимости от состояния (в корзине или нет).


---

## Класс ModalCardBasket

Расширяет класс `ProductCard` и отвечает за отображение карточки товара в корзине. 

### Свойства
- `_basketIndex: HTMLElement` — элемент для отображения индекса товара в корзине.
- `basketIndexDelete: HTMLButtonElement` — кнопка "Удалить".

### Конструктор
- `constructor(container: HTMLElement, events: IEvents, actions?: ICardActions)`  
  Инициализирует карточку товара в корзине, находит элементы индекса и кнопки "Удалить", настраивает обработчики событий.

### Методы
- `set basketIndex(index: number)`  
  Устанавливает индекс товара в корзине.

---


# Класс BasketView

Отвечает за отображение корзины товаров, включая список товаров, общую стоимость и управление кнопкой корзины.

### Свойства
- `events: IEvents` — объект для работы с событиями.
- `_basketButton: HTMLButtonElement` — кнопка корзины.
- `_totalPriceElement: HTMLElement` — элемент для отображения общей стоимости товаров.
- `_productList: HTMLElement` — контейнер для списка товаров в корзине.

### Конструктор
- `constructor(container: HTMLElement, events: IEvents)`  
  Инициализирует корзину, находит необходимые элементы в DOM и настраивает обработчики событий.

### Методы
- `set items(items: HTMLElement[])`  
  Устанавливает список товаров в корзине. Если корзина пуста, отображает сообщение "В корзине нет товаров" и блокирует кнопку корзины.

- `set totalPrice(total: number)`  
  Устанавливает общую стоимость товаров в корзине.

- `render(data?: IBasketDisplay): HTMLElement`  
  Обновляет содержимое корзины, включая список товаров и общую стоимость. Возвращает контейнер корзины.


---


## Класс ContactForm

Отвечает за управление формой контактной информации. 

### Свойства
- `nextButton: HTMLButtonElement` — кнопка "Оплатить".

### Конструктор
- `constructor(container: HTMLFormElement, events: IEvents)`  
  Инициализирует форму контактной информации, находит кнопку "Оплатить" в DOM и настраивает обработчик события для отправки формы.

### Методы
- `get form(): HTMLFormElement`  
  Возвращает текущую форму.

- `set disabled(valid: boolean)`  
  Устанавливает состояние кнопки "Оплатить" (активна/неактивна) в зависимости от валидности формы.


---


## Класс OrderPaymentForm


### Свойства
- `paymentButtons: HTMLButtonElement[]` — массив кнопок для выбора способа оплаты.
- `cardPaymentButton: HTMLButtonElement` — кнопка выбора оплаты картой.
- `cashPaymentButton: HTMLButtonElement` — кнопка выбора оплаты наличными.
- `nextButton: HTMLButtonElement` — кнопка "Далее".

### Конструктор
- `constructor(container: HTMLFormElement, events: IEvents)`  
  Инициализирует форму оплаты, находит необходимые элементы в DOM и настраивает обработчики событий.

### Методы
- `set disabled(isValid: boolean)`  
  Устанавливает состояние кнопки "Далее" (активна/неактивна) в зависимости от валидности формы.

- `set address(value: string)`  
  Устанавливает значение поля адреса.

- `set phone(value: string)`  
  Устанавливает значение поля телефона.

- `set email(value: string)`  
  Устанавливает значение поля email.

- `get form(): HTMLFormElement`  
  Возвращает текущую форму.

 - `resetPaymentMethod(): void`  
  Сбрасывает выбранный способ оплаты, убирая активное состояние с кнопок.


---

## Класс SuccessView

Отвечает за отображение успешного завершения заказа, включая итоговую сумму и кнопку закрытия.

### Свойства
- `totalElement: HTMLElement` — элемент для отображения итоговой суммы.
- `closeButton: HTMLButtonElement` — кнопка закрытия окна успешного завершения.

### Конструктор
- `constructor(container: HTMLFormElement, events: IEvents, actions?: ICardActions)`  
  Инициализирует окно успешного завершения, находит необходимые элементы в DOM и настраивает обработчики событий.

### Методы
- `set totalSum(value: number)`  
  Устанавливает итоговую сумму заказа.


---

# Взаимодействие компонентов

Логика взаимодействия между представлением (View) и данными (Model) реализована в файле index.ts, который выступает в роли презентера (Presenter). Взаимодействие строится на основе событий, которые генерируются с использованием механизма EventEmitter. Обработка этих событий настраивается в index.ts.


## Список событий

### В системе используются следующие события:

- events.onAll — Прослушивание всех событий в системе.

- basket:changed — Событие, возникающее при изменении состояния корзины.

- card:select — Выбор карточки товара для отображения в модальном окне.

- delete:card — Удаление карточки товара из корзины.

- basket:open — Открытие корзины.

- modal:open — Открытие модального окна.

- modal:close — Закрытие модального окна.

- order:changed — Изменение данных пользователя в заказе.

- payment:change — Изменение выбранного способа оплаты.

- order:open — Открытие модального окна для выбора оплаты и ввода адреса.

- order:submit — Открытие модального окна для ввода контактной информации.

- ^order\..*:change — Регулярное выражение для отслеживания изменений в окне выбора оплаты и адреса.

- ^contacts\..*:change — Регулярное выражение для отслеживания изменений в окне ввода email и телефона.

- contacts:submit — Отправка заказа и открытие финального окна с подтверждением.